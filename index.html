<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Prontuários</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="prontuarios.css"> 
</head>
<body>
    <header class="main-header">
        <div class="user-info">
            <span id="headerUsername">Luciana Viana</span> 
        </div>
    </header>

    <main class="main-content">
        <div class="record-list-container" id="recordListContainer">
            <h2>Meus Prontuários</h2>
            <div class="sort-options">
                <label for="sortOrder">Ordenar por:</label>
                <select id="sortOrder">
                    <option value="lastModifiedDesc">Última Modificação (Recente)</option>
                    <option value="appointmentDateDesc">Data do Atendimento (Recente)</option>
                    <option value="appointmentDateAsc">Data do Atendimento (Antigo)</option>
                    <option value="patientNameAsc">Nome do Paciente (A-Z)</option>
                    <option value="patientNameDesc">Nome do Paciente (Z-A)</option>
                </select>
            </div>
            <ul id="recordsList">
                <li class="no-records-message">Nenhum prontuário salvo ainda. Clique em "Novo Prontuário" para começar.</li>
            </ul>
            <button class="new-record-button" id="newRecordButton">Novo Prontuário</button>
        </div>

        <div class="record-form-container" id="recordFormContainer" style="display: none;">
            <h2>Novo Prontuário</h2>
            <div class="form-group">
                <label for="patientName">Nome do Paciente:</label>
                <input type="text" id="patientName" placeholder="Digite o nome do paciente" required>
            </div>

            <div class="form-group">
                <label for="recordRelate">Relato Inicial (Opcional):</label>
                <textarea id="recordRelate" placeholder="Breve resumo da situação inicial..." rows="3"></textarea>
            </div>

            <div class="form-group">
                <label for="appointmentDate">Data do Atendimento:</label>
                <input type="date" id="appointmentDate" required>
            </div>

            <div class="form-group">
                <label for="medicalRecord">Prontuário Detalhado (Opcional):</label>
                <textarea id="medicalRecord" placeholder="Digite o prontuário completo do paciente aqui..."></textarea>
            </div>

            <div class="form-group">
                <label for="pdfUpload">Anexar PDF (Opcional):</label>
                <input type="file" id="pdfUpload" accept="application/pdf">
                <span id="fileNameDisplay" style="font-size: 0.9em; color: #777; margin-top: 5px; display: block;"></span>
            </div>

            <div class="form-actions">
                <button class="save-button" id="saveRecordButton">Salvar Prontuário</button>
                <button class="cancel-button" id="cancelRecordButton">Cancelar</button>
            </div>
        </div>

        <div class="record-detail-container" id="recordDetailContainer" style="display: none;">
            <div class="detail-header">
                <h2 id="detailPatientName"></h2>
                <div class="record-actions">
                    <button class="action-button delete-button" id="deleteRecordButton">Excluir</button>
                </div>
            </div>
            <p><strong>Data do Atendimento:</strong> <span id="detailAppointmentDate"></span></p>
            <p><strong>Relato Inicial:</strong> <span id="detailRecordRelate"></span></p>
            <h3>Prontuário Completo:</h3>
            <p id="detailMedicalRecord"></p>

            <div id="pdfDisplayArea" style="margin-top: 20px;">
                <h3>Documento Anexado:</h3>
                <button class="action-button view-pdf-button" id="viewPdfButton" style="display: none;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text" style="vertical-align: middle; margin-right: 5px;">
                        <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                        <polyline points="14 2 14 8 20 8"></polyline>
                        <line x1="16" y1="13" x2="8" y2="13"></line>
                        <line x1="16" y1="17" x2="8" y2="17"></line>
                        <polyline points="10 9 9 9 8 9"></polyline>
                    </svg>
                    Ver PDF Anexado
                </button>
                <p id="noPdfMessage" style="color: #777; display: none;">Nenhum PDF anexado.</p>
            </div>

            <hr class="separator">

            <h3>Acompanhamentos:</h3>
            <ul id="followUpsList">
                <li class="no-followups-message">Nenhum acompanhamento registrado para este prontuário.</li>
            </ul>
            <button class="add-followup-button" id="addFollowUpButton">Adicionar Novo Acompanhamento</button>

            <div class="form-actions bottom-actions">
                <button class="back-button" id="backToListButton">Voltar à Lista</button>
            </div>
        </div>

        <div class="followup-form-container" id="followUpFormContainer" style="display: none;">
            <h2 id="followUpPatientNameTitle"></h2>
            <h3>Novo Acompanhamento</h3>
            <div class="form-group">
                <label for="followUpDate">Data do Acompanhamento:</label>
                <input type="date" id="followUpDate" required>
            </div>

            <div class="form-group">
                <label for="followUpText">Registro do Acompanhamento (Opcional):</label>
                <textarea id="followUpText" placeholder="Digite o registro do acompanhamento aqui..."></textarea>
            </div>

            <div class="form-group">
                <label for="followUpPdfUpload">Anexar PDF (Opcional):</label>
                <input type="file" id="followUpPdfUpload" accept="application/pdf">
                <span id="followUpFileNameDisplay" style="font-size: 0.9em; color: #777; margin-top: 5px; display: block;"></span>
            </div>

            <div class="form-actions">
                <button class="save-button" id="saveFollowUpButton">Salvar Acompanhamento</button>
                <button class="cancel-button" id="cancelFollowUpButton">Cancelar</button>
            </div>
        </div>

        <div id="followUpModal" class="modal" style="display: none;">
            <div class="modal-content">
                <span class="close-button" id="closeFollowUpModal">&times;</span>
                <h3 id="modalFollowUpDate"></h3>
                <p id="modalFollowUpText"></p>
            </div>
        </div>

        <div id="pdfModal" class="modal" style="display: none;">
            <div class="modal-content pdf-viewer-modal-content">
                <span class="close-button" id="closePdfModal">&times;</span>
                <h3 id="pdfModalTitle">Visualizar PDF</h3>
                <iframe id="pdfViewerIframe" src="" frameborder="0" width="100%" height="calc(100vh - 150px)"></iframe>
            </div>
        </div>
    </main>

    <div class="fixed-bottom-left-image">
        <img src="assets/fundosf.png" alt="Foto da Luciana" id="bottomLeftPhoto">
    </div>

    <script type="module" src="build/pdf.mjs"></script>

    <script src="prontuarios.js"></script>

    <script>
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('appointmentDate').setAttribute('max', today);
        document.getElementById('followUpDate').setAttribute('max', today);
    </script>
</body>
</html>